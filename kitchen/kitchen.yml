---
transport:
  forward_agent: true
  username: ubuntu

provisioner:
  name: shell
  require_chef_omnibus: false
  script: base/bootstrap.sh

verifier:
  name: inspec
  inspec_tests:
    - test/smoke/default

platforms:
  - name: ubuntu
    driver:
      box: bento/ubuntu-16.04

suites:
  - name: aws
    driver:
      name: ec2
      interface: private_dns
      image_id: <%= ENV['FOGG_IMAGE_ID'] %>
      spot_price: <%= ENV['FOGG_SPOT_PRICE'] || '0.01' %>
      instance_type: <%= ENV['FOGG_INSTANCE_TYPE'] || 't2.nano' %>
      associate_public_ip: false
      iam_profile_name: <%= ENV['FOGG_SVC_IAM_PROFILE'] %>
      aws_ssh_key_id: <%= ENV['FOGG_SVC_SSH_KEY'] %>
      subnet_id: <%= (ENV['FOGG_SVC_SUBNETS']||"").split(/\s+/)[0] %>
      security_group_ids: 
        - <%= ENV['FOGG_ENV_SG'] %>
        - <%= ENV['FOGG_APP_SG'] %>
        - <%= ENV['FOGG_SVC_SG'] %>
