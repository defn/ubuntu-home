---
transport:
  forward_agent: true
  username: ubuntu

provisioner:
  name: shell
  require_chef_omnibus: false
  script: base/bootstrap.sh

verifier:
  name: inspec
  inspec_tests:
    - test/smoke/default

platforms:
  - name: ubuntu
    driver:
      box: bento/ubuntu-16.04
      image_id: <%= ENV['fogg__service_ami'] %>

suites:
  - name: aws
    platform: ubuntu
    driver:
      name: ec2
      interface: private_dns
      spot_price: <%= ENV['FOGG_SPOT_PRICE'] || '0.01' %>
      instance_type: <%= ENV['FOGG_INSTANCE_TYPE'] || 't2.micro' %>
      associate_public_ip: false
      iam_profile_name: <%= ENV['fogg__service_iam_profile'] %>
      aws_ssh_key_id: <%= ENV['fogg__key_name'] %>
      subnet_id: <%= (ENV['fogg__service_subnets']||"").split(/\s+/)[0] %>
      security_group_ids: 
        - "<%= ENV['fogg__env_sg'] %>"
        - "<%= ENV['fogg__app_sg'] %>"
        - "<%= ENV['fogg__service_sg'] %>"
