version: '2'

services:
  proxy:
    build: socat
    ports:
      - "127.0.0.1:13194:13194"
    command: TCP-LISTEN:13194,fork TCP:172.17.0.1:1194
    restart: always
  openvpn:
    image: kylemanna/openvpn
    volumes:
      - .:/local
      - ./config:/etc/openvpn
    network_mode: host
    cap_add:
      - NET_ADMIN
    environment:
      dest: docker-for-mac.ovpn
      DEBUG: '1'
    command: /local/helpers/run.sh
    restart: always
  imma:
    image: "imma:latest"
    privileged: true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${DATA}:/data
